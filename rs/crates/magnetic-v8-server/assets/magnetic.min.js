(function(f){var u=self.Magnetic={},v=null,d=null,c=null,y="disconnected",m=[],o={},C={},g="",b=new TextEncoder;u.status=function(){return y},u.connect=function(t,e){v=typeof e=="string"?f.querySelector(e):e,d=new EventSource(t),d.onmessage=function(n){try{var a=n.data;if(c&&c.store){var r=b.encode(a);if(r.length<=16384&&(new Uint8Array(c.memory.buffer).set(r,c.input_ptr()),c.store(r.length)===0))return}else{var i=T(a);if(i===g)return;g=i}k(JSON.parse(a))}catch(l){console.error("[magnetic] SSE error:",l)}},d.onerror=function(){c&&(y="offline")},y="connected",w()},u.disconnect=function(){d&&(d.close(),d=null),y="disconnected"};function k(t){if(!(!v||!t||!t.root)){var e=f.activeElement,n=null;e&&(e.tagName==="INPUT"||e.tagName==="TEXTAREA")&&(n={el:e,key:e.dataset?e.dataset.key:null,name:e.getAttribute("name"),start:e.selectionStart,end:e.selectionEnd,val:e.value});var a=t.root;if(a.key&&o[a.key]&&o[a.key].parentNode===v?_(o[a.key],a):(v.textContent="",v.appendChild(x(a))),n){var r=n.key?o[n.key]:n.name?v.querySelector("input[name='"+n.name+"'],textarea[name='"+n.name+"']"):null;if(r&&r!==f.activeElement){r.focus(),r.value=n.val;try{r.setSelectionRange(n.start,n.end)}catch{}}}}}u._apply=k;function x(t){var e=f.createElement(t.tag);if(t.key&&(e.dataset.key=t.key,o[t.key]=e),A(e,t),t.events)for(var n in t.events)e.dataset["a_"+n]=t.events[n];if(t.text!=null&&(e.textContent=t.text),t.children)for(var a=0;a<t.children.length;a++)e.appendChild(x(t.children[a]));return e}function _(t,e){if(A(t,e),e.events)for(var n in e.events)t.dataset["a_"+n]=e.events[n];var a=t.dataset;for(var r in a)if(r.indexOf("a_")===0){var i=r.slice(2);(!e.events||!(i in e.events))&&delete a[r]}if(e.children)O(t,e.children);else if(e.text!=null&&e.tag!="input"&&e.tag!="textarea")t.textContent=e.text;else if(!e.children&&e.text==null&&e.tag!="input"&&e.tag!="textarea")for(;t.firstChild;)E(t.firstChild),t.removeChild(t.firstChild)}function E(t){var e=t.dataset?t.dataset.key:null;e&&o[e]===t&&delete o[e];for(var n=t.firstChild;n;)E(n),n=n.nextSibling}function O(t,e){var n,a,r,i,l=[],S={};for(n=0;n<e.length;n++)a=e[n],a.key&&o[a.key]?(r=o[a.key],_(r,a),S[a.key]=!0):(r=x(a),a.key&&(S[a.key]=!0)),l.push(r);for(var s=t.firstChild;s;){var L=s.nextSibling;i=s.dataset?s.dataset.key:null,(!i||!S[i]||o[i]!==s)&&(E(s),t.removeChild(s)),s=L}for(n=0;n<l.length;n++)t.childNodes[n]!==l[n]&&t.insertBefore(l[n],t.childNodes[n]||null)}function A(t,e){if(e.attrs)for(var n in e.attrs)t.setAttribute(n,e.attrs[n])}function p(t){var e=t.target;return e.closest?e:e.parentElement}function w(){f.addEventListener("click",function(t){var e=p(t);if(e){var n=e.closest("[data-a_click]");n&&(t.preventDefault(),h(n.dataset.a_click,{}))}}),f.addEventListener("submit",function(t){var e=p(t);if(e){var n=e.closest("[data-a_submit]");if(n){t.preventDefault();var a={},r=new FormData(n);r.forEach(function(i,l){a[l]=i}),h(n.dataset.a_submit,a),n.querySelectorAll("input").forEach(function(i){i.value=""})}}}),f.addEventListener("input",function(t){var e=p(t);if(e){var n=e.closest("[data-a_input]");if(n){var a=n.dataset.a_input;clearTimeout(C[a]),C[a]=setTimeout(function(){h(a,{value:n.value})},300)}}})}u.send=h;function h(t,e){if(t.indexOf("navigate:")===0){var n=t.slice(9);history.pushState({},"",n),t="navigate",e={path:n}}var a=JSON.stringify({action:t,payload:e});fetch("/actions/"+encodeURIComponent(t),{method:"POST",headers:{"Content-Type":"application/json"},body:a}).then(function(r){return r.text()}).then(function(r){if(!(!r||r[0]!=="{")){if(c&&c.store){var i=b.encode(r);i.length<=16384&&(new Uint8Array(c.memory.buffer).set(i,c.input_ptr()),c.store(i.length))}else g=T(r);try{k(JSON.parse(r))}catch{}}}).catch(function(){}),y!="connected"&&m.push(a)}var N={};f.addEventListener("mouseenter",function(t){var e=p(t);if(e){var n=e.closest("[data-prefetch]");if(n){var a=n.getAttribute("data-prefetch");a&&!N[a]&&(N[a]=1,fetch(a,{method:"GET",headers:{"X-Prefetch":"1"}}).catch(function(){}))}}},!0),self.addEventListener("popstate",function(){h("navigate",{path:location.pathname+location.search})}),u.loadWasm=function(t){c===null&&(c=0,fetch(t).then(function(e){return e.arrayBuffer()}).then(function(e){return WebAssembly.instantiate(e,{})}).then(function(e){for(c=e.instance.exports;m.length;){var n=JSON.parse(m.shift());h(n.action,n.payload)}}).catch(function(){c=null}))};function T(t){for(var e=2166136261,n=0;n<t.length;n++)e^=t.charCodeAt(n),e=Math.imul(e,16777619);return e}})(document);
