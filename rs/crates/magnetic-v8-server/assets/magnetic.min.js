!function(e){var t=self.Magnetic={},n=null,a=null,r=null,i="disconnected",o=[],l={},c={},s="",f=new TextEncoder,u=[],d=0;function v(t){if(n&&t&&t.root){var a=e.activeElement,r=null;!a||"INPUT"!==a.tagName&&"TEXTAREA"!==a.tagName||(r={el:a,key:a.dataset?a.dataset.key:null,name:a.getAttribute("name"),start:a.selectionStart,end:a.selectionEnd,val:a.value});var i=t.root;if(i.key&&l[i.key]&&l[i.key].parentNode===n?y(l[i.key],i):(n.textContent="",n.appendChild(m(i))),r){var o=r.key?l[r.key]:r.name?n.querySelector("input[name='"+r.name+"'],textarea[name='"+r.name+"']"):null;if(o&&o!==e.activeElement){o.focus(),o.value=r.val;try{o.setSelectionRange(r.start,r.end)}catch(e){}}}}}t.status=function(){return i},t._renderers={},t.registerRenderer=function(e,n){t._renderers[e]=n},t.connect=function(t,o){n="string"==typeof o?e.querySelector(o):o,(a=new EventSource(t)).onmessage=function(e){try{var t=e.data,n=JSON.parse(t);if(n.delta){if(r&&r.delta_push)(a=f.encode(t)).length<=16384&&(new Uint8Array(r.memory.buffer).set(a,r.input_ptr()),r.delta_push(a.length));else u.push(n);return void(d||(d=requestAnimationFrame(p)))}if(r&&r.store){var a;if((a=f.encode(t)).length<=16384&&(new Uint8Array(r.memory.buffer).set(a,r.input_ptr()),0===r.store(a.length)))return}else{var i=b(t);if(i===s)return;s=i}v(n)}catch(e){console.error("[magnetic] SSE error:",e)}},a.onerror=function(){r&&(i="offline")},i="connected",e.addEventListener("click",function(e){var t=E(e);if(t){var n=t.closest("[data-a_click]");n&&(e.preventDefault(),C(n.dataset.a_click,{}))}}),e.addEventListener("submit",function(e){var t=E(e);if(t){var n=t.closest("[data-a_submit]");if(n){e.preventDefault();var a={};new FormData(n).forEach(function(e,t){a[t]=e}),C(n.dataset.a_submit,a),n.querySelectorAll("input").forEach(function(e){e.value=""})}}}),e.addEventListener("input",function(e){var t=E(e);if(t){var n=t.closest("[data-a_input]");if(n){var a=n.dataset.a_input;clearTimeout(c[a]),c[a]=setTimeout(function(){C(a,{value:n.value})},300)}}})},t.disconnect=function(){a&&(a.close(),a=null),i="disconnected"},t._apply=v;var h=new TextDecoder;function p(){var e;if(d=0,r&&r.delta_count&&r.delta_count()>0){e=[];for(var a=r.delta_count(),i=0;i<a;i++){var o=r.delta_ptr(i),c=r.delta_len(i),s=new Uint8Array(r.memory.buffer,o,c);try{e.push(JSON.parse(h.decode(s)))}catch(e){}}r.delta_clear()}else e=u,u=[];if(0!==e.length){for(var f={},v=0;v<e.length;v++){var p=e[v],y=t._renderers[p.k];if(y){var k=y(p.v);if(k&&(!k.key||!l[k.key])){var x=l[p.t]||n.querySelector('[data-key="'+p.t+'"]');if(x){l[p.t]||(l[p.t]=x);var _=m(k);x.insertBefore(_,x.firstChild),f[p.t]||(f[p.t]={el:x,max:p.max})}}}}for(var E in f)for(var C=f[E];C.max>0&&C.el.children.length>C.max;){var S=C.el.lastElementChild;if(!S)break;g(S),C.el.removeChild(S)}}}function m(t){var n=e.createElement(t.tag);if(t.key&&(n.dataset.key=t.key,l[t.key]=n),_(n,t),t.events)for(var a in t.events)n.dataset["a_"+a]=t.events[a];if(null!=t.text&&(n.textContent=t.text),t.children)for(var r=0;r<t.children.length;r++)n.appendChild(m(t.children[r]));return n}function y(e,t){if(_(e,t),t.events)for(var n in t.events)e.dataset["a_"+n]=t.events[n];var a=e.dataset;for(var r in a)if(0===r.indexOf("a_")){var i=r.slice(2);t.events&&i in t.events||delete a[r]}if(t.children)!function(e,t){var n,a,r,i,o=[],c={};for(n=0;n<t.length;n++)(a=t[n]).key&&l[a.key]?(y(r=l[a.key],a),c[a.key]=!0):(r=m(a),a.key&&(c[a.key]=!0)),o.push(r);var s=e.firstChild;for(;s;){var f=s.nextSibling;(i=s.dataset?s.dataset.key:null)&&c[i]&&l[i]===s||(g(s),e.removeChild(s)),s=f}for(n=0;n<o.length;n++)e.childNodes[n]!==o[n]&&e.insertBefore(o[n],e.childNodes[n]||null)}(e,t.children);else if(null!=t.text&&"input"!=t.tag&&"textarea"!=t.tag)e.textContent=t.text;else if(!t.children&&null==t.text&&"input"!=t.tag&&"textarea"!=t.tag)for(;e.firstChild;)g(e.firstChild),e.removeChild(e.firstChild)}function g(e){var t=e.dataset?e.dataset.key:null;t&&l[t]===e&&delete l[t];for(var n=e.firstChild;n;)g(n),n=n.nextSibling}var k=/^\s*javascript\s*:/i,x={href:1,src:1,action:1,formaction:1,"xlink:href":1};function _(e,t){if(t.attrs)for(var n in t.attrs){var a=t.attrs[n];x[n]&&k.test(a)||e.setAttribute(n,a)}}function E(e){var t=e.target;return t.closest?t:t.parentElement}function C(e,t){if(0===e.indexOf("navigate:")){var n=e.slice(9);history.pushState({},"",n),e="navigate",t={path:n}}var a=JSON.stringify({action:e,payload:t});fetch("/actions/"+encodeURIComponent(e),{method:"POST",headers:{"Content-Type":"application/json"},body:a}).then(function(e){return e.text()}).then(function(e){if(e&&"{"===e[0]){if(r&&r.store){var t=f.encode(e);t.length<=16384&&(new Uint8Array(r.memory.buffer).set(t,r.input_ptr()),r.store(t.length))}else s=b(e);try{v(JSON.parse(e))}catch(e){}}}).catch(function(){}),"connected"!=i&&o.push(a)}t.send=C;var S={};function b(e){for(var t=2166136261,n=0;n<e.length;n++)t^=e.charCodeAt(n),t=Math.imul(t,16777619);return t}e.addEventListener("mouseenter",function(e){var t=E(e);if(t){var n=t.closest("[data-prefetch]");if(n){var a=n.getAttribute("data-prefetch");a&&!S[a]&&(S[a]=1,fetch(a,{method:"GET",headers:{"X-Prefetch":"1"}}).catch(function(){}))}}},!0),self.addEventListener("popstate",function(){C("navigate",{path:location.pathname+location.search})}),t.loadWasm=function(e){null===r&&(r=0,fetch(e).then(function(e){return e.arrayBuffer()}).then(function(e){return WebAssembly.instantiate(e,{})}).then(function(e){for(r=e.instance.exports;o.length;){var t=JSON.parse(o.shift());C(t.action,t.payload)}}).catch(function(){r=null}))}}(document);